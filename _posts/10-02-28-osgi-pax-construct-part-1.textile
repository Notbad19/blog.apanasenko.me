---
layout: post
title: OSGI Pax Constructor
excerpt: Сегодня хотел бы рассказать о таком инструменте, как Pax Construct. Это фактически индустриальный стандарт для ведения проектов на основе технологии <b>OSGi</b>. Он доступен как стандэлон приложение, так и как плагин для maven2. <b>Pax Construct</b> предоставляет вам множество инструментов для проектов на основе OSGi, которые помогут вам быстро создавать и управлять вашим проектом. Основная функциональность обеспечивается за счет гибкой архитектуры и интеграции с <b>maven2</b>, что улучшает и упрощает процесс сборки OSGi проектов под Maven, так же доступные основные архетипы для новых проектов.
published: true
categories:
- java
- osgi
- pax
---

<div style="text-align: center;">
<img alt="pax-construct.png" border="0" height="278" src="http://lh3.ggpht.com/_wN3Yn5K_LYs/S4qgrm96rhI/AAAAAAAAALs/8oaJzXA9RLE/pax-construct.png?imgmax=800" width="417" /></div>

Сегодня хотел бы рассказать о таком инструменте, как "Pax Construct":http://wiki.ops4j.org/display/paxconstruct/Pax+Construct. Это фактически индустриальный стандарт для ведения проектов на основе технологии <b>OSGi</b>. Он доступен как "стандэлон приложение":http://wiki.ops4j.org/display/paxconstruct/Download, так и как плагин для "maven2":http://www.ops4j.org/projects/pax/construct/. <b>Pax Construct</b> предоставляет вам множество инструментов для проектов на основе OSGi, которые помогут вам быстро создавать и управлять вашим проектом. Основная функциональность обеспечивается за счет гибкой архитектуры и интеграции с <b>maven2</b>, что улучшает и упрощает процесс сборки OSGi проектов под Maven, так же доступные основные архетипы для новых проектов.

Есть несколько основных команд для работы с Pax Construct:

# pax-create-project
# pax-add-repository
# pax-create-module
# pax-create-bundle
# pax-provision
# pax-import-bundle
# pax-embed-jar
# pax-wrap-jar
# pax-move-bundle
# pax-remove-bundle
# pax-clone

h3. Pax create project

Давайте попробуем рассмотреть данные команды по ближе. Первой командой создадим "рыбу" для нового проекта:

{% highlight bash %}
home:paxtest apanasenko$ /opt/pax-construct-1.4/bin/pax-create-project
pax-create-project -g groupId -a artifactId [-v version] [-o] [-- mvnOpts ...]

groupId (examples) ? info.jprogers.pax
artifactId (myProject) ? pax-test
version (1.0-SNAPSHOT) ? 

[INFO] Scanning for projects...
[INFO] ------------------------------------------------------------------------
[INFO] Building Maven Default Project
[INFO]    task-segment: [org.ops4j:maven-pax-plugin:1.4:create-project] (aggregator-style)
[INFO] ------------------------------------------------------------------------
[INFO] Setting property: classpath.resource.loader.class => 'org.codehaus.plexus.velocity.ContextClassLoaderResourceLoader'.
[INFO] Setting property: velocimacro.messages.on => 'false'.
[INFO] Setting property: resource.loader => 'classpath'.
[INFO] Setting property: resource.manager.logwhenfound => 'false'.
[INFO] ************************************************************** 
[INFO] Starting Jakarta Velocity v1.4
[INFO] RuntimeInstance initializing.
[INFO] Default Properties File: org/apache/velocity/runtime/defaults/velocity.properties
[INFO] Default ResourceManager initializing. (class org.apache.velocity.runtime.resource.ResourceManagerImpl)
[INFO] Resource Loader Instantiated: org.codehaus.plexus.velocity.ContextClassLoaderResourceLoader
[INFO] ClasspathResourceLoader : initialization starting.
[INFO] ClasspathResourceLoader : initialization complete.
[INFO] ResourceCache : initialized. (class org.apache.velocity.runtime.resource.ResourceCacheImpl)
[INFO] Default ResourceManager initialization complete.
[INFO] Loaded System Directive: org.apache.velocity.runtime.directive.Literal
[INFO] Loaded System Directive: org.apache.velocity.runtime.directive.Macro
[INFO] Loaded System Directive: org.apache.velocity.runtime.directive.Parse
[INFO] Loaded System Directive: org.apache.velocity.runtime.directive.Include
[INFO] Loaded System Directive: org.apache.velocity.runtime.directive.Foreach
[INFO] Created: 20 parsers.
[INFO] Velocimacro : initialization starting.
[INFO] Velocimacro : adding VMs from VM library template : VM_global_library.vm
[ERROR] ResourceManager : unable to find resource 'VM_global_library.vm' in any resource loader.
[INFO] Velocimacro : error using  VM library template VM_global_library.vm : org.apache.velocity.exception.ResourceNotFoundException: Unable to find resource 'VM_global_library.vm'
[INFO] Velocimacro :  VM library template macro registration complete.
[INFO] Velocimacro : allowInline = true : VMs can be defined inline in templates
[INFO] Velocimacro : allowInlineToOverride = false : VMs defined inline may NOT replace previous VM definitions
[INFO] Velocimacro : allowInlineLocal = false : VMs defined inline will be  global in scope if allowed.
[INFO] Velocimacro : initialization complete.
[INFO] Velocity successfully started.
[INFO] [pax:create-project {execution: default-cli}]
[INFO] Selecting latest archetype release within version range [1,2)
[INFO] artifact org.ops4j.pax.construct:maven-archetype-osgi-project: checking for updates from central
Downloading: http://repo1.maven.org/maven2/org/ops4j/pax/construct/maven-archetype-osgi-project/1.0.3/maven-archetype-osgi-project-1.0.3.jar

[INFO] ----------------------------------------------------------------------------
[INFO] Using following parameters for creating Archetype: maven-archetype-osgi-project:1.0.3
[INFO] ----------------------------------------------------------------------------
[INFO] Parameter: packageName, Value: info.jprogers.pax.test
[INFO] Parameter: archetypeVersion, Value: 1.0.3
[INFO] Parameter: groupId, Value: info.jprogers.pax
[INFO] Parameter: archetypeArtifactId, Value: maven-archetype-osgi-project
[INFO] Parameter: version, Value: 1.0-SNAPSHOT
[INFO] Parameter: archetypeGroupId, Value: org.ops4j.pax.construct
[INFO] Parameter: basedir, Value: /Users/apanasenko/Documents/IdeaProject/paxtest
[INFO] Parameter: package, Value: info.jprogers.pax.test
[INFO] Parameter: artifactId, Value: pax-test
[INFO] ********************* End of debug info from resources from generated POM ***********************
[INFO] Archetype created in dir: /Users/apanasenko/Documents/IdeaProject/paxtest/pax-test
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESSFUL
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 9 seconds
[INFO] Finished at: Sun Feb 28 18:59:50 MSK 2010
[INFO] Final Memory: 16M/79M
[INFO] ------------------------------------------------------------------------
{% endhighlight %}

Эта команда нам создает папку с проектом:

{% highlight bash %}
home:paxtest apanasenko$ ls -al
total 0
drwxr-xr-x   3 apanasenko  staff   102 28 фев 18:59 .
drwxr-xr-x  37 apanasenko  staff  1258 28 фев 18:49 ..
drwxr-xr-x   5 apanasenko  staff   170 28 фев 18:59 pax-test
home:paxtest apanasenko$ cd pax-test/
home:pax-test apanasenko$ ls -al
total 8
drwxr-xr-x  5 apanasenko  staff   170 28 фев 18:59 .
drwxr-xr-x  3 apanasenko  staff   102 28 фев 18:59 ..
-rw-r--r--  1 apanasenko  staff  1912 28 фев 18:59 pom.xml
drwxr-xr-x  5 apanasenko  staff   170 28 фев 18:59 poms
drwxr-xr-x  3 apanasenko  staff   102 28 фев 18:59 provision
{% endhighlight %}

В которой сразу создана рутовая pom.xml и два идеологических модуля:

{% highlight bash %}
home:pax-test apanasenko$ cd poms/
home:poms apanasenko$ ls -al
total 8
drwxr-xr-x  5 apanasenko  staff   170 28 фев 18:59 .
drwxr-xr-x  5 apanasenko  staff   170 28 фев 18:59 ..
drwxr-xr-x  3 apanasenko  staff   102 28 фев 18:59 compiled
-rw-r--r--  1 apanasenko  staff  2286 28 фев 18:59 pom.xml
drwxr-xr-x  3 apanasenko  staff   102 28 фев 18:59 wrappers
{% endhighlight %}

Первый модуль, который в себе инкапсулирует врапнутые бандлы(бандлы, которые вы создали сами из обычных java библиотек) в модуле <b>wrappers</b>. И содержит в себе один из главных артефактов в модуле <b>compiled</b>, который наследуется всеми модулями (которые на выходе имеют бандлы), в нем в частности содержаться настройки bnd плагина.
Второй модуль содержит в себе все импортируемые депенденси для вашего проекта.

h3. Pax add repository

С помощью команды pax-add-repository можно легко добавлять новые maven2 репозитории:

{% highlight bash %}
home:pax-test apanasenko$ /opt/pax-construct-1.4/bin/pax-add-repository

pax-add-repository -i repositoryId -u repositoryURL [-o] [-- mvnOpts ...]

repositoryId (ops4j.releases) ? 
repositoryURL (http://repository.ops4j.org/maven2/) ? 

[INFO] Scanning for projects...
[INFO] ------------------------------------------------------------------------
[INFO] Building info.jprogers.pax.test (OSGi project)
[INFO]    task-segment: [org.ops4j:maven-pax-plugin:1.4:add-repository] (aggregator-style)
[INFO] ------------------------------------------------------------------------
[INFO] [pax:add-repository {execution: default-cli}]
[INFO] Adding repository http://repository.ops4j.org/maven2/ to info.jprogers.pax:pax-test:pom:1.0-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESSFUL
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 5 seconds
[INFO] Finished at: Sun Feb 28 19:23:04 MSK 2010
[INFO] Final Memory: 14M/79M
[INFO] ------------------------------------------------------------------------
{% endhighlight %}

h3. Pax create module

В этой команде все достаточно просто мы создаем модуль в котором далее будет хранить свои бандлы: 

{% highlight bash %}
home:pax-test apanasenko$ /opt/pax-construct-1.4/bin/pax-create-module

pax-create-module [-g groupId] -a modulePath [-v version] [-o] [-- mvnOpts ...]

groupId () ? info.jprogers.pax.test
artifactId (myModule) ? test
version () ? 

[INFO] Scanning for projects...
[INFO] ------------------------------------------------------------------------
[INFO] Building info.jprogers.pax.test (OSGi project)
[INFO]    task-segment: [org.ops4j:maven-pax-plugin:1.4:create-module] (aggregator-style)
[INFO] ------------------------------------------------------------------------
[INFO] [pax:create-module {execution: default-cli}]
[INFO] Created new module /Users/apanasenko/Documents/IdeaProject/paxtest/pax-test/test
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESSFUL
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 3 seconds
[INFO] Finished at: Sun Feb 28 19:33:42 MSK 2010
[INFO] Final Memory: 14M/79M
[INFO] ------------------------------------------------------------------------
home:pax-test apanasenko$ ls -al
total 8
drwxr-xr-x  6 apanasenko  staff   204 28 фев 19:33 .
drwxr-xr-x  3 apanasenko  staff   102 28 фев 18:59 ..
-rw-r--r--  1 apanasenko  staff  2162 28 фев 19:33 pom.xml
drwxr-xr-x  5 apanasenko  staff   170 28 фев 18:59 poms
drwxr-xr-x  3 apanasenko  staff   102 28 фев 18:59 provision
drwxr-xr-x  3 apanasenko  staff   102 28 фев 19:33 test
{% endhighlight %}

h3. Pax create bundle 

С помощью этой команды мы можем создавать свои бандлы, которые автоматически добавятся в нужную помку и занаследуют нужный парент артифакт: 

{% highlight bash %}
home:test apanasenko$ /opt/pax-construct-1.4/bin/pax-create-bundle

pax-create-bundle -p package [-n bundleName] [-g bundleGroupId] [-v version] [-o] [-- mvnOpts ...]

package (org.example.pkg) ? info.jprogers.pax.test
bundleName () ? pax-test
bundleGroupId () ? info.jprogers.pax.test 
version (1.0-SNAPSHOT) ? 

[INFO] Scanning for projects...
[INFO] ------------------------------------------------------------------------
[INFO] Building 
[INFO]    task-segment: [org.ops4j:maven-pax-plugin:1.4:create-bundle] (aggregator-style)
[INFO] ------------------------------------------------------------------------
[INFO] Setting property: classpath.resource.loader.class => 'org.codehaus.plexus.velocity.ContextClassLoaderResourceLoader'.
[INFO] Setting property: velocimacro.messages.on => 'false'.
[INFO] Setting property: resource.loader => 'classpath'.
[INFO] Setting property: resource.manager.logwhenfound => 'false'.
[INFO] ************************************************************** 
[INFO] Starting Jakarta Velocity v1.4
[INFO] RuntimeInstance initializing.
[INFO] Default Properties File: org/apache/velocity/runtime/defaults/velocity.properties
[INFO] Default ResourceManager initializing. (class org.apache.velocity.runtime.resource.ResourceManagerImpl)
[INFO] Resource Loader Instantiated: org.codehaus.plexus.velocity.ContextClassLoaderResourceLoader
[INFO] ClasspathResourceLoader : initialization starting.
[INFO] ClasspathResourceLoader : initialization complete.
[INFO] ResourceCache : initialized. (class org.apache.velocity.runtime.resource.ResourceCacheImpl)
[INFO] Default ResourceManager initialization complete.
[INFO] Loaded System Directive: org.apache.velocity.runtime.directive.Literal
[INFO] Loaded System Directive: org.apache.velocity.runtime.directive.Macro
[INFO] Loaded System Directive: org.apache.velocity.runtime.directive.Parse
[INFO] Loaded System Directive: org.apache.velocity.runtime.directive.Include
[INFO] Loaded System Directive: org.apache.velocity.runtime.directive.Foreach
[INFO] Created: 20 parsers.
[INFO] Velocimacro : initialization starting.
[INFO] Velocimacro : adding VMs from VM library template : VM_global_library.vm
[ERROR] ResourceManager : unable to find resource 'VM_global_library.vm' in any resource loader.
[INFO] Velocimacro : error using  VM library template VM_global_library.vm : org.apache.velocity.exception.ResourceNotFoundException: Unable to find resource 'VM_global_library.vm'
[INFO] Velocimacro :  VM library template macro registration complete.
[INFO] Velocimacro : allowInline = true : VMs can be defined inline in templates
[INFO] Velocimacro : allowInlineToOverride = false : VMs defined inline may NOT replace previous VM definitions
[INFO] Velocimacro : allowInlineLocal = false : VMs defined inline will be  global in scope if allowed.
[INFO] Velocimacro : initialization complete.
[INFO] Velocity successfully started.
[INFO] [pax:create-bundle {execution: default-cli}]
[INFO] Selecting latest archetype release within version range [1,2)
[INFO] ----------------------------------------------------------------------------
[INFO] Using following parameters for creating Archetype: maven-archetype-osgi-bundle:1.0.3
[INFO] ----------------------------------------------------------------------------
[INFO] Parameter: symbolicName, Value: info.jprogers.pax.test
[INFO] Parameter: packageName, Value: info.jprogers.pax.test
[INFO] Parameter: archetypeVersion, Value: 1.0.3
[INFO] Parameter: groupId, Value: info.jprogers.pax.test
[INFO] Parameter: archetypeArtifactId, Value: maven-archetype-osgi-bundle
[INFO] Parameter: version, Value: 1.0-SNAPSHOT
[INFO] Parameter: archetypeGroupId, Value: org.ops4j.pax.construct
[INFO] Parameter: isMultiModuleProject, Value: true
[INFO] Parameter: basedir, Value: /Users/apanasenko/Documents/IdeaProject/paxtest/pax-test/test
[INFO] Parameter: package, Value: info.jprogers.pax.test
[INFO] Parameter: artifactId, Value: pax-test
[INFO] ********************* End of debug info from resources from generated POM ***********************
[INFO] Archetype created in dir: /Users/apanasenko/Documents/IdeaProject/paxtest/pax-test/test/pax-test
[INFO] ----------------------------------------------------------------------------
[INFO] Using following parameters for creating Archetype: maven-archetype-osgi-service:1.0.3
[INFO] ----------------------------------------------------------------------------
[INFO] Parameter: symbolicName, Value: info.jprogers.pax.test
[INFO] Parameter: packageName, Value: info.jprogers.pax.test
[INFO] Parameter: archetypeVersion, Value: 1.0.3
[INFO] Parameter: groupId, Value: info.jprogers.pax
[INFO] Parameter: archetypeArtifactId, Value: maven-archetype-osgi-service
[INFO] Parameter: version, Value: 1.0-SNAPSHOT
[INFO] Parameter: archetypeGroupId, Value: org.ops4j.pax.construct
[INFO] Parameter: isMultiModuleProject, Value: true
[INFO] Parameter: basedir, Value: /Users/apanasenko/Documents/IdeaProject/paxtest/pax-test/test
[INFO] Parameter: package, Value: info.jprogers.pax.test
[INFO] Parameter: artifactId, Value: pax-test
[INFO] ********************* End of debug info from resources from generated POM ***********************
[INFO] Archetype created in dir: /Users/apanasenko/Documents/IdeaProject/paxtest/pax-test/test/pax-test
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESSFUL
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 3 seconds
[INFO] Finished at: Sun Feb 28 19:40:53 MSK 2010
[INFO] Final Memory: 16M/79M
[INFO] ------------------------------------------------------------------------
home:test apanasenko$ ls -al
total 8
drwxr-xr-x  4 apanasenko  staff  136 28 фев 19:40 .
drwxr-xr-x  6 apanasenko  staff  204 28 фев 19:33 ..
drwxr-xr-x  5 apanasenko  staff  170 28 фев 19:40 pax-test
-rw-r--r--  1 apanasenko  staff  611 28 фев 19:40 pom.xml
{% endhighlight %}

h3. Pax provision

С помощью этой команды мы можем запустить наш проект либо отдельный бандл. Дефолтным контейнером используеться <b>Apache Felix</b>, но всегда можно поменять на интересующую через тег:

{% highlight bash %}
--platform=equinox
{% endhighlight %}
<br/>

{% highlight bash %}
home:pax-test apanasenko$ /opt/pax-construct-1.4/bin/pax-provision
[INFO] Scanning for projects...
[INFO] Reactor build order: 
[INFO]   info.jprogers.pax.test (OSGi project)
[INFO]   pax-test - plugin configuration
[INFO]   pax-test - wrapper instructions
[INFO]   pax-test - bundle instructions
[INFO]   pax-test - imported bundles
[INFO]   info.jprogers.pax.test
[INFO]   
[INFO] ------------------------------------------------------------------------
[INFO] Building info.jprogers.pax.test (OSGi project)
[INFO]    task-segment: [org.ops4j:maven-pax-plugin:1.4:provision] (aggregator-style)
[INFO] ------------------------------------------------------------------------
[INFO] [pax:provision {execution: default-cli}]
[INFO] Installing /Users/apanasenko/Documents/IdeaProject/paxtest/pax-test/runner/deploy-pom.xml to /Users/apanasenko/.m2/repository/info/jprogers/pax/test/build/deployment/1.0-SNAPSHOT/deployment-1.0-SNAPSHOT.pom
[INFO] artifact org.ops4j.pax.runner:pax-runner: checking for updates from ops4j.releases
[INFO] artifact org.ops4j.pax.runner:pax-runner: checking for updates from central
__________                 __________                                 
\______   \_____  ___  ___ \______   \__ __  ____   ____   ___________
|     ___/\__  \ \  \/  /  |       _/  |  \/    \ /    \_/ __ \_  __ \
|    |     / __ \_>    <   |    |   \  |  /   |  \   |  \  ___/|  | \/
|____|    (____  /__/\_ \  |____|_  /____/|___|  /___|  /\___  >__|   
\/      \/         \/           \/     \/     \/       

Pax Runner (1.4.0) from OPS4J - http://www.ops4j.org
----------------------------------------------------

-> Using config [classpath:META-INF/runner.properties]
-> Using only arguments from command line
-> Scan bundles from [/Users/apanasenko/Documents/IdeaProject/paxtest/pax-test/runner/deploy-pom.xml]
-> Scan bundles from [scan-pom:file:/Users/apanasenko/Documents/IdeaProject/paxtest/pax-test/runner/deploy-pom.xml]
-> Provision bundle [mvn:info.jprogers.pax.test/pax-test/1.0-SNAPSHOT, at default start level, bundle will be started, bundle will be loaded from the cache]
-> Preparing framework [Felix 2.0.2]
-> Downloading bundles...
-> Felix 2.0.2 : 388030 bytes @ [ 16kBps ]
-> Felix Shell (1.4.1) : 62616 bytes @ [ 13kBps ]
-> Felix TUI Shell (1.4.1) : 12748 bytes @ [ 20kBps ]
-> mvn:info.jprogers.pax.test/pax-test/1.0-SNAPSHOT : 5332 bytes @ [ 380kBps ]
-> Using execution environment [J2SE-1.6]
-> Runner has successfully finished his job!


Welcome to Felix
================

-> STARTING info.jprogers.pax.test
REGISTER info.jprogers.pax.test.ExampleService
Command not found.
-> ps
START LEVEL 6
ID   State         Level  Name
[   0] [Active     ] [    0] System Bundle (2.0.2)
[   1] [Active     ] [    5] info.jprogers.pax.test (1.0.0.SNAPSHOT)
[   2] [Active     ] [    1] Apache Felix Shell Service (1.4.1)
[   3] [Active     ] [    1] Apache Felix Shell TUI (1.4.1)
-> shutdown
-> STOPPING info.jprogers.pax.test

-> Platform has been shutdown.
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESSFUL
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 1 minute 46 seconds
[INFO] Finished at: Sun Feb 28 19:51:56 MSK 2010
[INFO] Final Memory: 15M/79M
[INFO] ------------------------------------------------------------------------
{% endhighlight %}