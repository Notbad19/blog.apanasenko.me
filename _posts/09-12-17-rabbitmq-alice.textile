---
layout: post
title: RabbitMQ & Alice
excerpt: Есть такой прекрасный проект RabbitMQ. И вот появилась задача организовать мониторинг за <strong>RabbitMQ</strong> сервером. Поискав не много в <strong>google</strong> нашел решение в виде Alice - это приложение выставляющие <strong>RESTful API</strong> написанное на <strong>Erlang</strong>. 
published: true
categories:
- alice
- rabbitmq
- erlang
---

<div style="text-align:center;">
<img src="http://lh4.ggpht.com/_wN3Yn5K_LYs/SyqR8I8dGTI/AAAAAAAAAJw/wuv2EgwDM_A/alice-1.jpg?imgmax=800" alt="alice-1.jpg" border="0" width="350" height="350" /></div>

Есть такой прекрасный проект <a href="http://www.rabbitmq.com/">RabbitMQ</a>. И вот появилась задача организовать мониторинг за <strong>RabbitMQ</strong> сервером. Поискав не много в <strong>google</strong> нашел решение в виде <a href="github.com/auser/alice">Alice</a> - это приложение выставляющие <strong>RESTful API</strong> написанное на <strong>Erlang</strong>. 

В связи с этим хочу рассказать не много о проблемах с которыми столкнулся. Первое если у вас <strong>OSX Snow Leopard</strong> и ошибка вида:

{% highlight erlang %}
=CRASH REPORT==== 12-Oct-2009::23:29:20 ===
  crasher:
    initial call: memsup:init/1
    pid: <0.76.0>
    registered_name: memsup
    exception exit: },
                     [{memsup,get_memory_usage,1},
                      {memsup,'-handle_info/2-fun-0-',2}]}
      in function  gen_server:terminate/6
    ancestors: [os_mon_sup,<0.46.0>]
    messages: []
    links: [<0.47.0>]
    dictionary: []
    trap_exit: true
    status: running
    heap_size: 233
    stack_size: 24
    reductions: 172
  neighbours:
{% endhighlight %}

то сразу отправляемся <a href="http://www.willcodeforfoo.com/2009/10/12/borked-erlang-on-snow-leopard/">сюда</a>.

{% highlight bash %}
git clone git://github.com/auser/alice.git
{% endhighlight %}

Далее запускаем <strong>./start.sh</strong>. Если <strong>Alice</strong> ругается и не хочет подключаться к <strong>RabbitMQ</strong> с логами такого вида:

{% highlight erlang %}
------------- Alice ------------
Copyright (C) 2009 Ari Lerner, Nate Murray, Michael Fairchild, CloudTeam

rabbit node : rabbit@ваш хост
connected   : false
		Your cookie is set to 'ваш секрет кей'
		Make sure your rabbitmq server's .erlang.cookie file matches
---------------------------------
=ERROR REPORT==== 9-Dec-2009::06:27:05 ===
Lost connection with rabbitmq_server. Trying to regain connection to 'rabbit@ваш хост'
{% endhighlight %}

То надо синхронизировать <strong>.erlang.cookie</strong> пользователя от которого будет запускаться <strong>Alice</strong> и <strong>RabbitMQ</strong>. Для верности попробуйте просто запустить две коносоли <strong>Erlang</strong>'a от этих пользователей и связать их в кластер с помощью команд:

{% highlight erlang %}
net_adm:ping('хост удаленной ноды').
{% endhighlight %}

и проверить с помощью команды:

{% highlight erlang %}
nodes().
{% endhighlight %}