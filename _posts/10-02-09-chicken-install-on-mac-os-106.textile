---
layout: post
title: Chicken install on Mac OS 10.6
excerpt: Недавно занялся изучением <b>Scheme</b> и для этого стал использовать текстовый редактор <b>TextMate</b>, который имеет интеграцию в виде bundl'a с интерпретатором <b>Chicken</b>. И так приступим к выявлению проблем и героическому решению...
published: true
categories:
- fl
- fp
- mac os
- scheme
image: http://lh5.ggpht.com/_wN3Yn5K_LYs/S3E8PPuvQtI/AAAAAAAAALA/DBuAElszD5s/chicken4-low.png?imgmax=800
---

<center><img alt="chicken4-low.png" height="400" src="http://lh5.ggpht.com/_wN3Yn5K_LYs/S3E8PPuvQtI/AAAAAAAAALA/DBuAElszD5s/chicken4-low.png?imgmax=800" width="335" /></center>

Недавно занялся изучением <b>Scheme</b> и для этого стал использовать текстовый редактор <b>TextMate</b>, который имеет интеграцию в виде bundl'a с интерпретатором <b>Chicken</b>. И так приступим к выявлению проблем и героическому решению...

Первым делом я решил посмотреть в портах и увидел, что там находиться довольно старая версия 3.4.0, но все таки решил попробовать поставить её:

{% highlight bash %}
sudo port search chicken
chicken @3.4.0 (lang, scheme)
    Compiler for the Scheme programming language

cotvnc @2.0b4 (aqua, vnc)
    Chicken of the VNC is a VNC client for Mac OS X

swig-chicken @1.3.40 (devel, lang)
    Chicken binding for swig

Found 3 ports.
{% endhighlight %}
<br/>

{% highlight bash %}
sudo port install chicken
--->  Computing dependencies for chicken
--->  Fetching chicken
--->  Attempting to fetch chicken-3.4.0.tar.gz from http://arn.se.distfiles.macports.org/chicken
--->  Attempting to fetch chicken-3.4.0.tar.gz from http://chicken.wiki.br/releases/3.4.0
--->  Verifying checksum(s) for chicken
--->  Extracting chicken
--->  Configuring chicken
--->  Building chicken
Error: Target org.macports.build returned: shell command "cd /opt/local/var/macports/build/_opt_local_var_macports_sources_rsync.macports.org_release_ports_lang_chicken/work/chicken-3.4.0 &amp;&amp; /usr/bin/make PLATFORM=macosx PREFIX=/opt/local bootstrap" returned error 2
Command output: echo "#define HAVE_UNSIGNED_LONG_LONG 1" >>chicken-config.h
echo "#define STDC_HEADERS 1" >>chicken-config.h
echo "#define HAVE_ALLOCA 1" >>chicken-config.h
echo "#define HAVE_ALLOCA_H 1" >>chicken-config.h
echo "#define HAVE_GRP_H 1" >>chicken-config.h
echo "#define HAVE_CRT_EXTERNS_H 1" >>chicken-config.h
echo "#define HAVE_ERRNO_H 1" >>chicken-config.h
echo "#define HAVE_SYSEXITS_H 1" >>chicken-config.h
echo "#define C_STACK_GROWS_DOWNWARD 1" >>chicken-config.h
echo "#define C_HACKED_APPLY" >>chicken-config.h
cat chicken-defaults.h >>chicken-config.h
/usr/bin/gcc-4.2 -no-cpp-precomp -fno-strict-aliasing -fno-common -DHAVE_CHICKEN_CONFIG_H -DC_ENABLE_PTABLES -I. -I./ \
   -c -Os -fomit-frame-pointer chicken.c -o chicken-static.o
/usr/bin/gcc-4.2 -no-cpp-precomp -fno-strict-aliasing -fno-common -DHAVE_CHICKEN_CONFIG_H -DC_ENABLE_PTABLES -I. -I./ \
   -c -Os -fomit-frame-pointer batch-driver.c -o batch-driver-static.o
/usr/bin/gcc-4.2 -no-cpp-precomp -fno-strict-aliasing -fno-common -DHAVE_CHICKEN_CONFIG_H -DC_ENABLE_PTABLES -I. -I./ \
   -c -Os -fomit-frame-pointer compiler.c -o compiler-static.o
/usr/bin/gcc-4.2 -no-cpp-precomp -fno-strict-aliasing -fno-common -DHAVE_CHICKEN_CONFIG_H -DC_ENABLE_PTABLES -I. -I./ \
   -c -Os -fomit-frame-pointer optimizer.c -o optimizer-static.o
/usr/bin/gcc-4.2 -no-cpp-precomp -fno-strict-aliasing -fno-common -DHAVE_CHICKEN_CONFIG_H -DC_ENABLE_PTABLES -I. -I./ \
   -c -Os -fomit-frame-pointer support.c -o support-static.o
/usr/bin/gcc-4.2 -no-cpp-precomp -fno-strict-aliasing -fno-common -DHAVE_CHICKEN_CONFIG_H -DC_ENABLE_PTABLES -I. -I./ \
   -c -Os -fomit-frame-pointer c-platform.c -o c-platform-static.o
/usr/bin/gcc-4.2 -no-cpp-precomp -fno-strict-aliasing -fno-common -DHAVE_CHICKEN_CONFIG_H -DC_ENABLE_PTABLES -I. -I./ \
   -c -Os -fomit-frame-pointer c-backend.c -o c-backend-static.o
/usr/bin/gcc-4.2 -no-cpp-precomp -fno-strict-aliasing -fno-common -DHAVE_CHICKEN_CONFIG_H -c apply-hack.x86.s -o apply-hack.x86.o
apply-hack.x86.s:35:suffix or operands invalid for `call'
make[2]: *** [apply-hack.x86.o] Error 1
make[1]: *** [bootstrap] Error 2
make: *** [bootstrap] Error 2

Error: Status 1 encountered during processing.
{% endhighlight %}

И увидел такую вот не приятную картину, не много по гуглив набрел на багтрекер макпортс и как бы там решалась подобная проблема, но версия была 4.3.0. Что заставило меня попробовать обновить порты. Но почему-то версия в портах так и не обновилась, забив на это, решил скачать исходники и скопилять самому:

{% highlight bash %}
sudo make PLATFORM=macosx ARCH=x86-64 PREFIX=/opt/local install
make -f ./Makefile.macosx CONFIG= install
mkdir -p /opt/local/lib 
mkdir -p /opt/local/lib/chicken 
mkdir -p /opt/local/lib/chicken/4 
mkdir -p /opt/local/share/chicken 
mkdir -p /opt/local/include
mkdir -p /opt/local/bin
mkdir -p /opt/local/share/man/man1 
mkdir -p /opt/local/share/man 
mkdir -p /opt/local/share/chicken/doc
install -m644 libchicken.a /opt/local/lib
install -m644 libuchicken.a /opt/local/lib
install -m644 ./chicken.h /opt/local/include
install -m644 chicken-config.h /opt/local/include
install -m755 libchicken.dylib \
   /opt/local/lib/libchicken.dylib
install -m755 libuchicken.dylib \
   /opt/local/lib/libuchicken.dylib
install -m755 scheme.import.so /opt/local/lib/chicken/4
install -m755 chicken.import.so /opt/local/lib/chicken/4
install -m755 lolevel.import.so /opt/local/lib/chicken/4
install -m755 srfi-1.import.so /opt/local/lib/chicken/4
install -m755 srfi-4.import.so /opt/local/lib/chicken/4
install -m755 data-structures.import.so /opt/local/lib/chicken/4
install -m755 ports.import.so /opt/local/lib/chicken/4
install -m755 files.import.so /opt/local/lib/chicken/4
install -m755 posix.import.so /opt/local/lib/chicken/4
install -m755 srfi-13.import.so /opt/local/lib/chicken/4
install -m755 srfi-69.import.so /opt/local/lib/chicken/4
install -m755 extras.import.so /opt/local/lib/chicken/4
install -m755 regex.import.so /opt/local/lib/chicken/4
install -m755 srfi-14.import.so /opt/local/lib/chicken/4
install -m755 tcp.import.so /opt/local/lib/chicken/4
install -m755 foreign.import.so /opt/local/lib/chicken/4
install -m755 srfi-18.import.so /opt/local/lib/chicken/4
install -m755 utils.import.so /opt/local/lib/chicken/4
install -m755 csi.import.so /opt/local/lib/chicken/4
install -m755 irregex.import.so /opt/local/lib/chicken/4
install -m755 setup-api.import.so /opt/local/lib/chicken/4
install -m755 setup-download.import.so /opt/local/lib/chicken/4
install -m644 ./setup.defaults /opt/local/share/chicken
install -m755 setup-api.so /opt/local/lib/chicken/4
install -m755 setup-download.so /opt/local/lib/chicken/4
install -m755 chicken /opt/local/bin
install -m755 csi /opt/local/bin
install -m755 chicken-profile /opt/local/bin
install -m755 csc /opt/local/bin
install -m755 chicken-bug /opt/local/bin
install_name_tool -change libchicken.dylib /opt/local/lib/libchicken.dylib /opt/local/bin/chicken
install_name_tool -change libchicken.dylib /opt/local/lib/libchicken.dylib /opt/local/bin/csi
install_name_tool -change libchicken.dylib /opt/local/lib/libchicken.dylib /opt/local/bin/chicken-profile
install_name_tool -change libchicken.dylib /opt/local/lib/libchicken.dylib /opt/local/bin/csc
install_name_tool -change libchicken.dylib /opt/local/lib/libchicken.dylib /opt/local/bin/chicken-bug
install_name_tool -change libchicken.dylib /opt/local/lib/libchicken.dylib /opt/local/lib/chicken/4/setup-api.so
install_name_tool -change libchicken.dylib /opt/local/lib/libchicken.dylib /opt/local/lib/chicken/4/setup-download.so
install_name_tool -change libchicken.dylib /opt/local/lib/libchicken.dylib /opt/local/lib/chicken/4/setup-api.import.so
install_name_tool -change libchicken.dylib /opt/local/lib/libchicken.dylib /opt/local/lib/chicken/4/setup-download.import.so
install_name_tool -change libchicken.dylib /opt/local/lib/libchicken.dylib /opt/local/lib/chicken/4/chicken.import.so
install_name_tool -change libchicken.dylib /opt/local/lib/libchicken.dylib /opt/local/lib/chicken/4/lolevel.import.so
install_name_tool -change libchicken.dylib /opt/local/lib/libchicken.dylib /opt/local/lib/chicken/4/srfi-1.import.so
install_name_tool -change libchicken.dylib /opt/local/lib/libchicken.dylib /opt/local/lib/chicken/4/srfi-4.import.so
install_name_tool -change libchicken.dylib /opt/local/lib/libchicken.dylib /opt/local/lib/chicken/4/data-structures.import.so
install_name_tool -change libchicken.dylib /opt/local/lib/libchicken.dylib /opt/local/lib/chicken/4/ports.import.so
install_name_tool -change libchicken.dylib /opt/local/lib/libchicken.dylib /opt/local/lib/chicken/4/files.import.so
install_name_tool -change libchicken.dylib /opt/local/lib/libchicken.dylib /opt/local/lib/chicken/4/posix.import.so
install_name_tool -change libchicken.dylib /opt/local/lib/libchicken.dylib /opt/local/lib/chicken/4/srfi-13.import.so
install_name_tool -change libchicken.dylib /opt/local/lib/libchicken.dylib /opt/local/lib/chicken/4/srfi-69.import.so
install_name_tool -change libchicken.dylib /opt/local/lib/libchicken.dylib /opt/local/lib/chicken/4/extras.import.so
install_name_tool -change libchicken.dylib /opt/local/lib/libchicken.dylib /opt/local/lib/chicken/4/regex.import.so
install_name_tool -change libchicken.dylib /opt/local/lib/libchicken.dylib /opt/local/lib/chicken/4/irregex.import.so
install_name_tool -change libchicken.dylib /opt/local/lib/libchicken.dylib /opt/local/lib/chicken/4/srfi-14.import.so
install_name_tool -change libchicken.dylib /opt/local/lib/libchicken.dylib /opt/local/lib/chicken/4/tcp.import.so
install_name_tool -change libchicken.dylib /opt/local/lib/libchicken.dylib /opt/local/lib/chicken/4/foreign.import.so
install_name_tool -change libchicken.dylib /opt/local/lib/libchicken.dylib /opt/local/lib/chicken/4/scheme.import.so
install_name_tool -change libchicken.dylib /opt/local/lib/libchicken.dylib /opt/local/lib/chicken/4/csi.import.so
install_name_tool -change libchicken.dylib /opt/local/lib/libchicken.dylib /opt/local/lib/chicken/4/srfi-18.import.so
install_name_tool -change libchicken.dylib /opt/local/lib/libchicken.dylib /opt/local/lib/chicken/4/utils.import.so
install -m755 chicken-install /opt/local/bin
install -m755 chicken-uninstall /opt/local/bin
install -m755 chicken-status /opt/local/bin
install -m755 chicken-setup /opt/local/bin
install_name_tool -change libchicken.dylib /opt/local/lib/libchicken.dylib /opt/local/bin/chicken-install
install_name_tool -change libchicken.dylib /opt/local/lib/libchicken.dylib /opt/local/bin/chicken-uninstall
install_name_tool -change libchicken.dylib /opt/local/lib/libchicken.dylib /opt/local/bin/chicken-status
rm -f /opt/local/lib/chicken/4/compiler.import.so
/opt/local/bin/chicken-install -update-db
loading import libraries ...
generating database
 srfi-69 srfi-4 srfi-18 srfi-14 setup-download tcp setup-api srfi-13 srfi-1 utils scheme regex posix ports lolevel irregex foreign files extras data-structures csi chicken
  cp -r /tmp/chicken-install-310.tmp/modules.db /opt/local/lib/chicken/4/modules.db
install -m644 ./chicken.1 /opt/local/share/man/man1
install -m644 ./csi.1 /opt/local/share/man/man1
install -m644 ./csc.1 /opt/local/share/man/man1
install -m644 ./chicken-install.1 /opt/local/share/man/man1
install -m644 ./chicken-uninstall.1 /opt/local/share/man/man1
install -m644 ./chicken-status.1 /opt/local/share/man/man1
install -m644 ./chicken-profile.1 /opt/local/share/man/man1
install -m644 ./chicken-bug.1 /opt/local/share/man/man1
mkdir -p /opt/local/share/chicken/doc/html
install -m644 ./html/* /opt/local/share/chicken/doc/html
install -m644 ./README /opt/local/share/chicken/doc
install -m644 ./LICENSE /opt/local/share/chicken/doc
install -m644 ./types.db /opt/local/lib/chicken/4
home:chicken-4.3.0 2 apanasenko$ csi 
CHICKEN
(c)2008-2009 The Chicken Team
(c)2000-2007 Felix L. Winkelmann
Version 4.3.0
macosx-unix-gnu-x86-64 [ 64bit manyargs dload ptables ]
compiled 2010-02-09 on home.local (Darwin)
#;1> (exit)
{% endhighlight %}

Что и требовалось получить :) Благо у <b>Chicken</b> хороший мэйк файл, который содержит все нужные таргеты:

{% highlight bash %}
all:
 $(MAKE) -f $(SRCDIR)/Makefile.$(PLATFORM) CONFIG=$(CONFIG) all
clean:
 $(MAKE) -f $(SRCDIR)/Makefile.$(PLATFORM) CONFIG=$(CONFIG) clean
distclean:
 $(MAKE) -f $(SRCDIR)/Makefile.$(PLATFORM) CONFIG=$(CONFIG) distclean
spotless:
 $(MAKE) -f $(SRCDIR)/Makefile.$(PLATFORM) CONFIG=$(CONFIG) spotless
install:
 $(MAKE) -f $(SRCDIR)/Makefile.$(PLATFORM) CONFIG=$(CONFIG) install
uninstall:
 $(MAKE) -f $(SRCDIR)/Makefile.$(PLATFORM) CONFIG=$(CONFIG) uninstall
confclean:
 $(MAKE) -f $(SRCDIR)/Makefile.$(PLATFORM) CONFIG=$(CONFIG) confclean
check:
 $(MAKE) -f $(SRCDIR)/Makefile.$(PLATFORM) CONFIG=$(CONFIG) check
fullcheck:
 $(MAKE) -f $(SRCDIR)/Makefile.$(PLATFORM) CONFIG=$(CONFIG) fullcheck
dist:
 $(MAKE) -f $(SRCDIR)/Makefile.$(PLATFORM) CONFIG=$(CONFIG) distfiles
 csi -s scripts/makedist.scm
libs:
 $(MAKE) -f $(SRCDIR)/Makefile.$(PLATFORM) CONFIG=$(CONFIG) libs
bootstrap:
 $(MAKE) -f $(SRCDIR)/Makefile.$(PLATFORM) CONFIG=$(CONFIG) bootstrap
endif
{% endhighlight %}