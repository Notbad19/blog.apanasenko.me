<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ru" lang="ru">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="google-site-verification" content="bb8epm6suyHfvYU-yFKhhYMyg3SQ__QndlyH-vBmiAk"/>
  <meta name='yandex-verification' content='74e7c4ae6d68c097'/>
  <meta name="viewport" content="width=950, maximum-scale=1.0" />
  <meta name="description" content="Как бы не было смешно обоснования данного вопроса, но все таки Google. Так как Google сегодня самый большой частный владелец информации, сегодня это самый популярный поиск, один из основных игроков интернет сервисов. Объемы хранящейся у них информации растут с колоссальной скоростью. Все это дает Google авторитет в понимании проблем и наилучшего решения." />
  <meta http-equiv="description" content="Как бы не было смешно обоснования данного вопроса, но все таки Google. Так как Google сегодня самый большой частный владелец информации, сегодня это самый популярный поиск, один из основных игроков интернет сервисов. Объемы хранящейся у них информации растут с колоссальной скоростью. Все это дает Google авторитет в понимании проблем и наилучшего решения."/> 
  <meta name="robots" content="all"/> 
  <meta name="resourse-type" content="document"/> 
  <meta name="document-state" content="dynamic"/> 
  <meta name="revisit-after" content="1 days"/> 
  <meta http-equiv="author" content="Anton Panasenko"/>
  <meta name="copyright" content="Copyright (C) 2011 "/> 
  <meta name="document-state" content="dynamic"/> 
  <link rev="made" href="anton.panasenko@gmail.com"/> 
  <meta http-equiv="reply-to" content="anton.panasenko@gmail.com"/> 
  <meta name="site-created" content="Anton Panasenko - blog.apanasenko.me"/> 
  <meta name="addres" content="blog.apanasenko.me"/> 
  <meta name="distribution" content="global"/> 
  <title>
    GFS -  Anton Panasenko
  </title>
  <link rel="stylesheet" href="/css/reset.css" type="text/css"/>
  
  <link rel="stylesheet" href="/css/screen.css" type="text/css"/>
  <link rel="stylesheet" href="/css/syntax.css" type="text/css"/>
  <link rel="stylesheet" media="only screen and (max-device-width: 480px)" href="/css/iphone.css" type="text/css"/>
  <link rel="stylesheet" media="only screen and (max-device-width: 1024px)" href="/css/ipad.css" type="text/css"/>
  <link rel="alternate" type="application/atom+xml" href="http://feeds.feedburner.com/apanasenko"/>
  <link href="/images/favicon.ico" rel="shortcut icon" type="image/x-icon"/>
  <link href="/images/icon.jpg" rel="apple-touch-icon"/>
</head>
<body>
  <div id="wrapper">
    <div class="center"><a href="http://blog.apanasenko.me/"><img class="header" alt="header image" src="/images/header.jpg"/></a></div>
    <div id="inner">
      <div id="container">
        <div id="header">
          <h1>
            
              <a href="/">&larr; Anton Panasenko</a>
            
          </h1>
          <ul class="header">
            <li>
              <a href="/archive">Archive</a>
            </li>
	    <li>
		<a href="http://ru.linkedin.com/in/apanasenko/">LinkedIn <span class="arrow">&rarr;</span></a>
	    </li>
            <li>
		<a href="http://github.com/dieu">Github <span class="arrow">&rarr;</span></a>
            </li>
            <li>
              <a href="http://twitter.com/apanasenko">Twitter <span class="arrow">&rarr;</span></a>
            </li>
          </ul>
          <hr class="right"/>
        </div>
        <h2>GFS</h2>
        

<span id="article_buttons">
  <a id="tweet">
    <span class="balloon">tweet!</span> <img src="/images/tweet.png"/ alt="tweet"/>
  </a>
  <a href="http://feeds.feedburner.com/apanasenko">
    <span class="balloon">subscribe!</span> <img src="/images/feed.png" alt="feed"/> 
  </a>
</span>

<hr/>

<div id="content">
	<p><object style="margin:0px" width="425" height="355"><param name="movie" value="http://static.slidesharecdn.com/swf/ssplayer2.swf?doc=gfs-091116025918-phpapp01&stripped_title=gfs-2509004" /><br />
<param name="allowFullScreen" value="true"/><br />
<param name="allowScriptAccess" value="always"/><br />
<embed src="http://static.slidesharecdn.com/swf/ssplayer2.swf?doc=gfs-091116025918-phpapp01&stripped_title=gfs-2509004" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" width="425" height="355"></embed></object><div style="font-size:11px;font-family:tahoma,arial;height:26px;padding-top:2px;"><br />
View more <a style="text-decoration:underline;" href="http://www.slideshare.net/">presentations</a> from <a style="text-decoration:underline;" href="http://www.slideshare.net/DieuMort">Anton</a>. Download <a style="text-decoration:underline;" href="http://www.slideshare.net/DieuMort/gfs-2509004" title="Gfs">here</a>.</div></p>
<h4>Почему <span class="caps">GFS</span>?</h4>
<p>Как бы не было смешно обоснования данного вопроса, но все таки Google. Так как Google сегодня самый большой частный владелец информации, сегодня это самый популярный поиск, один из основных игроков интернет сервисов. Объемы хранящейся у них информации растут с колоссальной скоростью. Все это дает Google авторитет в понимании проблем и наилучшего решения.</p>
<h4>Проблемы построения <span class="caps">DFS</span></h4>
<ol>
	<li><strong>Консистентность данных.</strong><br />
Это одна из основных проблем построения распределенных файловых систем (<span class="caps">DFS</span>). При построении <span class="caps">DFS</span> для более двух клиентов не противоричивость данных, согласованность друг с дургом достаточно сложно гарантировать, так как в основе  <span class="caps">DFS</span> лежит распределенность ключевых узлов системы.</li>
	<li><strong>Защита от сбоев.</strong><br />
Обычно <span class="caps">DFS</span> строятся из большого количества геторогенного оборудования, по этому не обходимо построение разнообразных мониторингов, систем удаленного доступа, удаленного востоновления, валидации данных, etc. Самым простым способом защиты от потери данных (основная опастность при сбое) являеться репликация данных на разных узлах, тем самым гарантируя востоновления функционирования системы в случае сбоя. При этом опять возникает проблема консистентности данных.</li>
	<li><strong>Большие объемы данных.</strong><br />
Обьем информации растет намного быстрее чем физические возможности накопителей, в связи с этим использование традиционных файловых систем не возможно, а если брать во внимание проблемы озвученные ранее, то обьем хранимых данных увеличиваеться еще в несколько раз за счет решения тех проблем.</li>
	<li><strong>Высокая скорость доступа.</strong><br />
Из-за больших обьемов хранимых данных и физических особенностей накопителей не всегда можно обесепечить выскую скорость доступа.</li>
</ol>
<h4>Архитектура <span class="caps">GFS</span></h4>
<p>Система представляет из себя 3х звенную архитектуру:</p>
<ol>
	<li>Клиент файловой системы взимодействует с мастер нодами и чанк серверами. Имеет основные операции взаимодействия с файловой системой, которые управляются и проходят через мастер ноды;</li>
	<li>Мастер ноды отвечают за управление матаданными всей файловой системы, так же мастер ноды управляют всей глобальной дейтельностью системы, такие как сборка мусора, перемещение чанков между чанк серверами, etc. Мастер постоянно взаимодействует с чанк серверами по средством сервисных сообщений, с помощью которых опрашивает ноды для сбора разнообразных метрик и установки статуса;</li>
	<li>Чанк сервера являются сосбтвенно хранилищами данных (чанков). Чанки имеют фиксированный размер (настраиваемый) и уникальный глобальный 64 битный ключ. Так же данные на чанк серверах реприцируються между нодами, обычно используют до 3х реплик.</li>
</ol>
<p>Система не имеет совместимость с <span class="caps">POSIX</span> <span class="caps">API</span>, в связи с этим не имеет Vnode уровня для Unix like систем. Так же разработчики <span class="caps">GFS</span> не стали использовать кеширование данных, тем самым избавилисть от проблем с валидностью кеша, все операции кеширования вынесены на более высокие абстракции (BigTable, etc).</p>
<h4>Мастер нода</h4>
<p>Обычно используется одна мастер нода, что существенно упрощяет архитектуру и позволяет производить сложные перемещения данных, организовывать репликации, использовать глобальные мета данные. В то же время с первого взгляда может показаться, что использование только одного мастер сервера может привести к ботелнекам и может являться узким местом системы, но в Google работают достаточно умные люди, которые прекрасно понимают чего стоит такие решения. Решением данной проблемы являеться грамотное построение взаимодействие клиентов и <span class="caps">GFS</span>. Клиенты никогда не читают и не пишут данные через мастер сервер, в место этого они  спрашивают с каким чанк сервером они должны контактировать и дальше они взаимодействуют только с определенным чанк сервером напрямую. <br />
Мастер нода управляет репликациями чанков, принимает решения о размещении, создает новые чанки, а также координирует различную деятельность внутри системы  для сохранения чанков полностью реплицированными, балансировки нагрузки на чанк-серверы и сборки неиспользуемых ресурсов.</p>
<h4>Метаданные</h4>
<p>Мастер хранит три важных вида метаданных: пространства имен файлов и чанков, отображение файла в чанки и положение реплик чанков. Все метаданные хранятся в памяти мастера. Так как метаданные хранятся в памяти, операции мастера выполняются быстро. Состояние дел в системе мастер узнает просто и эффективно. Он выполняется сканирование чанк-серверов в фоновом режиме. Эти периодические сканирования используются для сборки мусора, дополнительных репликаций, в случае обнаружения недоступного чанк-сервера и перемещение чанков, для балансировки нагрузки и свободного места на жестких дисках чанк-серверов.Мастер отслеживает положение чанков. При старте чанк-сервера мастер запоминает его чанки. В процессе работы мастер контролирует все перемещения чанков и состояния чанк-серверов. Таким образом, он обладает всей информацией о положении каждого чанка.Важная часть метаданных — это лог операций. Мастер хранит последовательность операций критических изменений метаданных. По этим отметкам в логе операций, определяется логическое время системы. Именно это логическое время определяет версии файлов и чанков.Так как лог операций важная часть, то он должен надежно храниться, и все изменения в нем должны становиться видимыми для клиентов, только когда изменятся метаданные. Лог операций реплицируется на несколько удаленных машин, и система реагирует на клиентскую операцию, только после сохранения этого лога на диск мастера и диски удаленных машин.Мастер восстанавливает состояние системы, исполняя лог операций. Лог операций сохраняет относительно небольшой размер, сохраняя только последние операции. В процессе работы мастер создает контрольные точки, когда размер лога превосходит некоторой величины, и восстановить систему можно только до ближайшей контрольной точки. Далее по логу можно заново воспроизвести некоторые операции, таким образом, система может откатываться до точки, которая находится между последней контрольной точкой и текущем временем.</p>
<h4>Взаимодействие в нутри системы</h4>
<ol>
	<li>Клиент спрашивает мастера, какой из чанк-серверов владеет чанком, и где находится этот чанк в других репликах. Если необходимо, то мастер отдает чанк кому-то во владение;</li>
	<li>Мастер в ответ выдает первичную реплику, и остальные (вторичные) реплики. Клиент хранит эти данные для дальнейших действий. Теперь, общение с мастером клиенту может понадобиться только, если первичная реплика станет недоступной;</li>
	<li>Далее клиент отсылает данные во все реплики. Он может это делать в произвольном порядке. Каждый чанк-сервер будет их хранить в специальном буфере, пока они не понадобятся или не устареют;</li>
	<li>Когда все реплики примут эти данные, клиент посылает запрос на запись первичной реплике. В этом запросе содержатся идентификация данных, которые были посланы в шаге. Теперь первичная реплика устанавливает порядок, в котором должны выполняться все изменения, которые она получила, возможно от нескольких клиентов параллельно. И затем, выполняет эти изменения локально в этом определенном порядке.<br />
Первичная реплика пересылает запрос на запись всем вторичным репликам;</li>
	<li>Каждая вторичная реплика выполняет эти изменения в порядке, определенном первичной репликой;</li>
	<li>Вторичные реплики рапортуют об успешном выполнении этих операций;</li>
	<li>Первичная реплика шлет ответ клиенту. Любые ошибки, возникшие в какой-либо реплике, также отсылаются клиенту. Если ошибка возникла при записи в первичной реплике, то и запись во вторичные реплики не происходит, иначе запись произошла в первичной реплике, и подмножестве вторичных. В этом случае клиент обрабатывает ошибку и решает, что ему дальше с ней делать.</li>
</ol>
<h4>Сбои системы</h4>
<p>Авторы системы считают одной из наиболее сложных проблем частые сбои работы компонентов системы. Количество и качество компонентов делают эти сбои не просто исключением, а скорее нормой. Сбой компонента может быть вызван недоступностью этого компонента или, что хуже, наличием испорченных данных. <span class="caps">GFS</span> поддерживает систему в рабочем виде при помощи двух простых стратегий: быстрое восстановление и репликации.Быстрое восстановление — это, фактически, перезагрузка машины. При этом время запуска очень маленькое, что приводит к маленькой заминке, а затем работа продолжается штатно. Про репликации чанков уже говорилось выше. Мастер реплицирует чанк, если одна из реплик стала недоступной, либо повредились данные, содержащие реплику чанка. Поврежденные чанки определяется при помощи вычисления контрольных сумм.Еще один вид репликаций в системе, про который мало было сказано — это репликация мастера. Реплицируется лог операций и контрольные точки (checkpoints). Каждое изменение файлов в системе происходит только после записи лога операций на диски мастером, и диски машин, на которые лог реплицируется. В случае небольших неполадок мастер может перезагрузиться. В случае проблем с жестким диском или другой жизненно важной инфраструктурой мастера, <span class="caps">GFS</span> стартует нового мастера, на одной из машин, куда реплицировались данные мастера. Клиенты обращаются к мастеру по <span class="caps">DNS</span>, который может быть переназначен новой машине. Новый мастер является тенью старого, а не точной копией. Поэтому у него есть доступ к файлам только для чтения. То есть он не становится полноценным мастером, а лишь поддерживает лог операций и другие структуры мастера. Важной частью системы является возможность поддерживать целостность данных. Обычный <span class="caps">GFS</span> кластер состоит из сотен машин, на которых расположены тысячи жестких дисков, и эти диски при работе с завидным постоянством выходят из строя, что приводит к порче данных. Система может восстановить данные с помощью репликаций, но для этого необходимо понять испортились ли данные. Простое сравнение различных реплик на разных чанк-серверах является неэффективным. Более того, может происходить несогласованность данных между различными репликами, ведущая к различию данных. Поэтому каждый чанк-сервер должен самостоятельно определять целостность данных. Каждый чанк разбивается на блоки длиной 64 Кбайт. Каждому такому блоку соответствует 32-битная контрольная сумма. Как и другие метаданные эти суммы хранятся в памяти, регулярно сохраняются в лог, отдельно от данных пользователя. Перед тем как считать данные чанк-сервер проверяет контрольные суммы блоков чанка, которые пересекаются с затребованными данными пользователем или другим чанк-сервером. То есть чанк-сервер не распространяет испорченные данные. В случае несовпадения контрольных сумм, чанк-сервер возвращает ошибку машине, подавшей запрос, и рапортует о ней мастеру. Пользователь может считать данные из другой реплики, а мастер создает еще одну копию из данных другой реплики. После этого мастер дает инструкцию этому чанк-серверу об удалении этой испорченной реплики. При добавлении новых данных, верификация контрольных сумм не происходит, а для блоков записывается новые контрольные суммы. В случае если диск испорчен, то это определится при попытке чтения этих данных. При записи чанк-сервер сравнивает только первый и последний блоки, пересекающиеся с границами, в которые происходит запись, поскольку часть данных на этих блоках не перезаписывается и необходимо проверить их целостность.</p>

	
		<h4>Posted 16 Nov 2009 by Anton Panasenko | tags:
		 
					
				<a href="/search/label/gfs">gfs</a>
			 
		 
			
				and <a href="/search/label/google">google</a>.
			 
		
	</h4>
</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
  (function() {
   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = 'http://dieu.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

<!--

-->

      </div>

      <div id="slide_bar">
		<div id="subscribe">
			<a href="http://feeds.feedburner.com/apanasenko" rel="alternate" title="feed" type="application/rss+xml"><img alt="rss" src="http://lh3.ggpht.com/_wN3Yn5K_LYs/SviFaWzVaAI/AAAAAAAAACE/t5QGxBDsiMs/rss.png"/></a>
		</div>	
        <div id="cloud_tag">
          <div id="cloud_tag_div">
                <ol id="tag-cloud"><li title="1 post"><a href="/search/label/actors">actors</a></li> <li title="1 post"><a href="/search/label/alice">alice</a></li> <li title="2 posts"><a href="/search/label/amazon">amazon</a></li> <li title="1 post"><a href="/search/label/apple">apple</a></li> <li title="1 post"><a href="/search/label/aws">aws</a></li> <li title="1 post"><a href="/search/label/azure">azure</a></li> <li title="1 post"><a href="/search/label/blog">blog</a></li> <li title="1 post"><a href="/search/label/book">book</a></li> <li title="1 post"><a href="/search/label/build">build</a></li> <li title="1 post"><a href="/search/label/cassandra">cassandra</a></li> <li title="1 post"><a href="/search/label/chef">chef</a></li> <li title="1 post"><a href="/search/label/client">client</a></li> <li title="1 post"><a href="/search/label/clips">clips</a></li> <li title="1 post"><a href="/search/label/clojure">clojure</a></li> <li title="1 post"><a href="/search/label/cloud">cloud</a></li> <li title="1 post"><a href="/search/label/consistent">consistent</a></li> <li title="1 post"><a href="/search/label/db">db</a></li> <li title="1 post"><a href="/search/label/deploy">deploy</a></li> <li title="1 post"><a href="/search/label/django">django</a></li> <li title="2 posts"><a href="/search/label/dvcs">dvcs</a></li> <li title="2 posts"><a href="/search/label/ec2">ec2</a></li> <li title="4 posts"><a href="/search/label/erlang">erlang</a></li> <li title="5 posts"><a href="/search/label/fl">fl</a></li> <li title="5 posts"><a href="/search/label/fp">fp</a></li> <li title="1 post"><a href="/search/label/gen_server">gen_server</a></li> <li title="1 post"><a href="/search/label/gfs">gfs</a></li> <li title="1 post"><a href="/search/label/git">git</a></li> <li title="1 post"><a href="/search/label/github">github</a></li> <li title="2 posts"><a href="/search/label/google">google</a></li> <li title="2 posts"><a href="/search/label/grid">grid</a></li> <li title="1 post"><a href="/search/label/hash">hash</a></li> <li title="2 posts"><a href="/search/label/hg">hg</a></li> <li title="1 post"><a href="/search/label/ipad">ipad</a></li> <li title="2 posts"><a href="/search/label/java">java</a></li> <li title="1 post"><a href="/search/label/jekyll">jekyll</a></li> <li title="3 posts"><a href="/search/label/jvm">jvm</a></li> <li title="1 post"><a href="/search/label/mac os">mac os</a></li> <li title="1 post"><a href="/search/label/mapreduce">mapreduce</a></li> <li title="1 post"><a href="/search/label/mercurial">mercurial</a></li> <li title="2 posts"><a href="/search/label/nosql">nosql</a></li> <li title="1 post"><a href="/search/label/objective-c">objective-c</a></li> <li title="1 post"><a href="/search/label/osgi">osgi</a></li> <li title="1 post"><a href="/search/label/pax">pax</a></li> <li title="1 post"><a href="/search/label/python">python</a></li> <li title="2 posts"><a href="/search/label/rabbitmq">rabbitmq</a></li> <li title="1 post"><a href="/search/label/ruby">ruby</a></li> <li title="3 posts"><a href="/search/label/scala">scala</a></li> <li title="1 post"><a href="/search/label/scheme">scheme</a></li> <li title="1 post"><a href="/search/label/server">server</a></li></ol>

          </div>
        </div>
		<br/>
		<div id="iready">
	    	<ol>
<li><a href="http://alenacpp.blogspot.com/">Алена С++</a></li>
<li></li>
<li><a href="http://samolisov.blogspot.com/">Челябинский Программист</a></li>
</ol>
        </div>
        <br/>
      </div> 
    </div>
  </div>

  <script src="/js/jquery.js" type="text/javascript"></script>
  <script src="/js/twitter.js" type="text/javascript"></script>
  <script type="text/javascript">
	var disqus_shortname = 'dieu';
	(function () {
	    var s = document.createElement('script'); s.async = true;
	    s.src = 'http://disqus.com/forums/dieu/count.js';
	    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
	}());
  </script>

  
<!-- Yandex.Metrika counter -->
<div style="display:none;"><script type="text/javascript">
(function(w, c) {
    (w[c] = w[c] || []).push(function() {
        try {
            w.yaCounter445478 = new Ya.Metrika(445478);
             yaCounter445478.clickmap(true);
             yaCounter445478.trackLinks(true);
        
        } catch(e) { }
    });
})(window, 'yandex_metrika_callbacks');
</script></div>
<script src="//mc.yandex.ru/metrika/watch.js" type="text/javascript" defer="defer"></script>
<noscript><img src="//mc.yandex.ru/watch/445478" style="position:absolute; left:-9999px;" alt="" /></noscript>
<!-- /Yandex.Metrika counter -->

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-6891853-5']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body>
</html>
