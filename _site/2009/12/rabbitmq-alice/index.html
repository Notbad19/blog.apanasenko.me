<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ru" lang="ru">
	<head>
 	  	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	  	<title>
	    	 RabbitMQ and Alice  
	  	</title>
		<link rel="stylesheet" href="/css/style.css" type="text/css" media="all"/>
	</head>
<body>
<div id="header">
	<ul id="nav" class="nav"> 
		<li id="main" class="selected"><a href="/"><strong>Home</strong><span>main page</span></a></li> 
		<li id="post"><a href="/2009/12/rabbitmq-alice"><strong>Blog</strong> <span>post</span></a></li>
		<li id="archive"><a href="/archive"><strong>Archive</strong></a></li> 
		<li><a href="http://ru.linkedin.com/in/apanasenko/"><strong>LinkedIn</strong> <span>&rarr;</span></a></li> 
		<li><a href="http://github.com/dieu"><strong>Github</strong> <span>&rarr;</span></a></li> 
		<li><a href="http://twitter.com/apanasenko"><strong>Twitter</strong> <span>&rarr;</span></a></li> 
	</ul>
</div>
<div id="container">			
	<div class="bar"> 
	</div> 
	<br/>
	<div id="content">
			<!-- <span id="article_buttons">
  <a id="tweet">
    <span class="balloon">tweet!</span> <img src="/images/tweet.png"/ alt="tweet"/>
  </a>
  <a href="http://feeds.feedburner.com/apanasenko">
    <span class="balloon">subscribe!</span> <img src="/images/feed.png" alt="feed"/> 
  </a>
</span>

<hr/> -->

<div class="content">
	<center><img src="http://lh4.ggpht.com/_wN3Yn5K_LYs/SyqR8I8dGTI/AAAAAAAAAJw/wuv2EgwDM_A/alice-1.jpg?imgmax=800" alt="alice-1.jpg" width="350" height="350" /></center>
<p>Есть такой прекрасный проект <a href="http://www.rabbitmq.com/">RabbitMQ</a>. И вот появилась задача организовать мониторинг за <strong>RabbitMQ</strong> сервером. Поискав не много в <strong>google</strong> нашел решение в виде <a href="github.com/auser/alice">Alice</a> &#8211; это приложение выставляющие <strong>RESTful <span class="caps">API</span></strong> написанное на <strong>Erlang</strong>.</p>
<p>В связи с этим хочу рассказать не много о проблемах с которыми столкнулся. Первое если у вас <strong><span class="caps">OSX</span> Snow Leopard</strong> и ошибка вида:</p>
<div class="highlight"><pre><code class="erlang"><span class="o">=</span><span class="nv">CRASH</span> <span class="nv">REPORT</span><span class="o">====</span> <span class="mi">12</span><span class="o">-</span><span class="nv">Oct</span><span class="o">-</span><span class="mi">2009</span><span class="p">::</span><span class="mi">23</span><span class="p">:</span><span class="mi">29</span><span class="p">:</span><span class="mi">20</span> <span class="o">===</span>
  <span class="nn">crasher</span><span class="p">:</span>
    <span class="n">initial</span> <span class="nn">call</span><span class="p">:</span> <span class="nn">memsup</span><span class="p">:</span><span class="n">init</span><span class="o">/</span><span class="mi">1</span>
    <span class="nn">pid</span><span class="p">:</span> <span class="o">&lt;</span><span class="mi">0</span><span class="p">.</span><span class="mi">76</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span>
    <span class="nn">registered_name</span><span class="p">:</span> <span class="n">memsup</span>
    <span class="n">exception</span> <span class="nb">exit</span><span class="p">:</span> <span class="p">},</span>
                     <span class="p">[{</span><span class="n">memsup</span><span class="p">,</span><span class="n">get_memory_usage</span><span class="p">,</span><span class="mi">1</span><span class="p">},</span>
                      <span class="p">{</span><span class="n">memsup</span><span class="p">,</span><span class="n">&#39;-handle_info/2-fun-0-&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">}]}</span>
      <span class="n">in</span> <span class="n">function</span>  <span class="nn">gen_server</span><span class="p">:</span><span class="n">terminate</span><span class="o">/</span><span class="mi">6</span>
    <span class="nn">ancestors</span><span class="p">:</span> <span class="p">[</span><span class="n">os_mon_sup</span><span class="p">,</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">.</span><span class="mi">46</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">]</span>
    <span class="nn">messages</span><span class="p">:</span> <span class="p">[]</span>
    <span class="nn">links</span><span class="p">:</span> <span class="p">[</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">.</span><span class="mi">47</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">]</span>
    <span class="nn">dictionary</span><span class="p">:</span> <span class="p">[]</span>
    <span class="nn">trap_exit</span><span class="p">:</span> <span class="n">true</span>
    <span class="nn">status</span><span class="p">:</span> <span class="n">running</span>
    <span class="nn">heap_size</span><span class="p">:</span> <span class="mi">233</span>
    <span class="nn">stack_size</span><span class="p">:</span> <span class="mi">24</span>
    <span class="nn">reductions</span><span class="p">:</span> <span class="mi">172</span>
  <span class="nn">neighbours</span><span class="p">:</span>
</code></pre>
</div><p>то сразу отправляемся <a href="http://www.willcodeforfoo.com/2009/10/12/borked-erlang-on-snow-leopard/">сюда</a>.</p>
<div class="highlight"><pre><code class="bash">git clone git://github.com/auser/alice.git
</code></pre>
</div><p>Далее запускаем <strong>./start.sh</strong>. Если <strong>Alice</strong> ругается и не хочет подключаться к <strong>RabbitMQ</strong> с логами такого вида:</p>
<div class="highlight"><pre><code class="erlang"><span class="p">-</span><span class="err">------------ A</span><span class="ni">lice</span> <span class="o">------------</span>
<span class="nv">Copyright</span> <span class="p">(</span><span class="nv">C</span><span class="p">)</span> <span class="mi">2009</span> <span class="nv">Ari</span> <span class="nv">Lerner</span><span class="p">,</span> <span class="nv">Nate</span> <span class="nv">Murray</span><span class="p">,</span> <span class="nv">Michael</span> <span class="nv">Fairchild</span><span class="p">,</span> <span class="nv">CloudTeam</span>

<span class="n">rabbit</span> <span class="nb">node</span> <span class="p">:</span> <span class="n">rabbit</span><span class="p">@</span><span class="err">ваш</span> <span class="err">хост</span>
<span class="n">connected</span> <span class="err"> </span> <span class="p">:</span> <span class="n">false</span>
		<span class="nv">Your</span> <span class="n">cookie</span> <span class="n">is</span> <span class="n">set</span> <span class="n">to</span> <span class="n">&#39;ваш секрет кей&#39;</span>
		<span class="nv">Make</span> <span class="n">sure</span> <span class="n">your</span> <span class="n">rabbitmq</span> <span class="n">server</span><span class="err">&#39;</span><span class="n">s</span> <span class="p">.</span><span class="n">erlang</span><span class="p">.</span><span class="n">cookie</span> <span class="n">file</span> <span class="n">matches</span>
<span class="p">-</span><span class="err">--------------------------------</span>
<span class="o">=</span><span class="nv">ERROR</span> <span class="nv">REPORT</span><span class="o">====</span> <span class="mi">9</span><span class="o">-</span><span class="nv">Dec</span><span class="o">-</span><span class="mi">2009</span><span class="p">::</span><span class="mi">06</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">05</span> <span class="o">===</span>
<span class="nv">Lost</span> <span class="n">connection</span> <span class="n">with</span> <span class="n">rabbitmq_server</span><span class="p">.</span> <span class="nv">Trying</span> <span class="n">to</span> <span class="n">regain</span> <span class="n">connection</span> <span class="n">to</span> <span class="n">&#39;rabbit@ваш хост&#39;</span>
</code></pre>
</div><p>То надо синхронизировать <strong>.erlang.cookie</strong> пользователя от которого будет запускаться <strong>Alice</strong> и <strong>RabbitMQ</strong>. Для верности попробуйте просто запустить две коносоли <strong>Erlang</strong>&#8217;a от этих пользователей и связать их в кластер с помощью команд:</p>
<div class="highlight"><pre><code class="erlang"><span class="nn">net_adm</span><span class="p">:</span><span class="n">ping</span><span class="p">(</span><span class="n">&#39;хост удаленной ноды&#39;</span><span class="p">).</span>
</code></pre>
</div><p>и проверить с помощью команды:</p>
<div class="highlight"><pre><code class="erlang"><span class="nb">nodes</span><span class="p">().</span>
</code></pre>
</div>

	
		<h4>Posted 17 Dec 2009 by Anton Panasenko | tags:
		 
			
				<a href="/search/label/alice">alice</a>,
			 
		 
					
				<a href="/search/label/rabbitmq">rabbitmq</a>
			 
		 
			
				and <a href="/search/label/erlang">erlang</a>.
			 
		
	</h4>
</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
  (function() {
   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = 'http://dieu.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript">
	$('#main').removeClass('selected');
	$('#post').addClass('selected');
</script>

<!--

-->

	</div>
</div>
<!-- <div id="footer">
	<a href="">Source code</a>
</div> -->

 <script type="text/javascript">
var disqus_shortname = 'dieu';
(function () {
    var s = document.createElement('script'); s.async = true;
    s.src = 'http://disqus.com/forums/dieu/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
 </script>

  
<!-- Yandex.Metrika counter -->
<div style="display:none;"><script type="text/javascript">
(function(w, c) {
    (w[c] = w[c] || []).push(function() {
        try {
            w.yaCounter445478 = new Ya.Metrika(445478);
             yaCounter445478.clickmap(true);
             yaCounter445478.trackLinks(true);
        
        } catch(e) { }
    });
})(window, 'yandex_metrika_callbacks');
</script></div>
<script src="//mc.yandex.ru/metrika/watch.js" type="text/javascript" defer="defer"></script>
<noscript><img src="//mc.yandex.ru/watch/445478" style="position:absolute; left:-9999px;" alt="" /></noscript>
<!-- /Yandex.Metrika counter -->

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-6891853-5']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body>
</html>